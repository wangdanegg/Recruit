/*
 * snapScroll 0.1.0
 * 
 *
 * http://www.ghugo.com
 *
 * Copyright 2014, hugohua
 *
 * Licensed under MIT
 *
 * Released on: August 10, 2014
*/
!function(a){a.fn.anim=function(a,b,c){var d,e,f=[];for(e in a)"opacity"===e?d=a[e]:f.push(e+"("+a[e]+")");return this.css({"-webkit-transition":"all "+(b||.5)+"s "+(c||""),"-webkit-transform":f.join(" "),opacity:d})}}(Zepto),function(a,b){var c=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(a){b.setTimeout(a,1e3/60)},d="ontouchstart"in b,e="onorientationchange"in b?"orientationchange":"resize",f=d?"touchstart":"mousedown",g=d?"touchmove":"mousemove",h=d?"touchend":"mouseup",i=d?"touchcancel":"mouseup",j="webkitTransitionEnd",k=function(){function k(b,c){this.$el=a(b),this.options=a.extend({},a.fn.snapscroll.defaults,c),this.init()}return k.prototype={constructor:k,name:"SnapScroll",version:"0.1.1",init:function(){this.$pages=this.$el.children(),this.length=this.$pages.length-1,this.curIndex=0,this.newIndex=0,this.startTime=null,this.drag=null,this.startY=null,this.direction=null,this.directionLocked=null,this.$target=null,this._initEvent()},_initEvent:function(){this.$el.on(f,a.proxy(this.handleEvent,this)).on(g,a.proxy(this.handleEvent,this)).on(h,a.proxy(this.handleEvent,this)).on(i,a.proxy(this.handleEvent,this)),this.$pages.on(j,a.proxy(this.handleEvent,this)),b.addEventListener(e,this,!1)},handleEvent:function(a){switch(a.type){case"tap":this._start(a);break;case f:this._start(a);break;case g:this._move(a);break;case h:case i:this._end(a);break;case j:this._flip(a);break;case e:this._resize()}},_start:function(a){if(!this.moved){var b=d?a.touches[0]:a;this._resize(),this.drag=!0,this.startX=b.pageX,this.startY=b.pageY}},_move:function(a){var b=this;if(a.preventDefault(),a.stopPropagation(),!b.moved&&b.drag){var c,e,f,g=d?a.touches[0]:a,h=g.pageX-b.startX,i=g.pageY-b.startY;if(b.absDistX=Math.abs(h),b.absDistY=Math.abs(i),!(b.absDistX<10&&b.absDistY<10)){if(!b.directionLocked){if(f=b.absDistX-b.absDistY-b.options.directionLockThreshold>0,"n"===b.options.scroll&&f||"h"===b.options.scroll?(b.directionLocked="h",b.direction=h>0?"LEFT":"RIGHT"):(b.directionLocked="v",b.direction=i>0?"DOWN":"UP"),b.newIndex="LEFT"===b.direction||"DOWN"===b.direction?b.curIndex-1:b.curIndex+1,b.options.loop)b.newIndex<0&&(b.newIndex=b.length),b.newIndex>b.length&&(b.newIndex=0);else if(b.newIndex<0||b.newIndex>b.length)return;b.$target=b.$pages.eq(b.newIndex),b.$el.trigger("start:"+b.name,[b.curIndex,b.newIndex,b.direction])}b.$target&&("UP"===b.direction?(c=0,e=b.height+i):"DOWN"===b.direction?(c=0,e=i-b.height):"LEFT"===b.direction?(c=h-b.width,e=0):"RIGHT"===b.direction&&(c=b.width+h,e=0),b.x=c,b.y=e,b._translate(c,e))}}},_end:function(){var a,b,c=0,d=0,e=this;e.drag=null,e.options.loop||(e.directionLocked=null,e.newIndex<0&&(e.newIndex=0),e.newIndex>e.length&&(e.newIndex=e.length)),e.$target&&e.$target.length&&(e.moved=!0,e.change=!0,a=e.height/e.absDistY>e.options.scrollThreshold,b=e.width/e.absDistX>e.options.scrollThreshold,"UP"===e.direction&&a?(c=0,d=e.height,e.change=null):"DOWN"===e.direction&&a?(c=0,d=-e.height,e.change=null):"LEFT"===e.direction&&b?(c=-e.width,d=0,e.change=null):"RIGHT"===e.direction&&b&&(c=e.width,d=0,e.change=null),e._scrollTo(c,d))},_flip:function(){this.moved&&(this._offTranslate(),this.directionLocked=null,this.moved=null,this.change&&(this.$pages.eq(this.curIndex).removeClass("show"),this.$target.addClass("show"),this.curIndex=this.newIndex),this.$target.removeClass("active").removeAttr("style"),this.$target=null,this.change=null,this.$el.trigger("done:"+this.name,[this.newIndex,this.direction]))},_resize:function(){this.width=this.$el.width(),this.height=this.$el.height()},_translate:function(a,b){var d=this;c(function(){d.$target&&d.$target.addClass("active").css({"-webkit-transform":"translate3d("+a+"px,"+b+"px,0)"})})},_scrollTo:function(a,b,c){c=c||this.options.speed,this.options.useTransition?(this.$target.css("-webkit-transition","-webkit-transform "+c+"ms"),this._translate(a,b)):this._animate(a,b,c)},_animate:function(a,b,d){function e(){return"v"==f.directionLocked&&g>0?(f.y+=h,f.y>b&&(f.y=b),f._translate(0,f.y)):"v"==f.directionLocked&&0>g?(f.y+=h,f.y<b&&(f.y=b),f._translate(0,f.y)):"h"==f.directionLocked&&g>0?(f.x+=h,f.x>a&&(f.x=a),f._translate(f.x,0)):"h"==f.directionLocked&&0>g&&(f.x+=h,f.x<a&&(f.x=a),f._translate(f.x,0)),"v"==f.directionLocked&&f.y===b||"h"==f.directionLocked&&f.x===a?void f._flip():void(("v"==f.directionLocked&&g>0&&f.y<b||"v"==f.directionLocked&&0>g&&f.y>b||"h"==f.directionLocked&&0>g&&f.x>a||"h"==f.directionLocked&&g>0&&f.x<a)&&c(e))}var f=this,g="v"==f.directionLocked?b-f.y:a-f.x,h=g/d*16;0!==g&&e()},_offTranslate:function(){this.$target.css("-webkit-transition","-webkit-transform 0ms")},goTo:function(a,b){this.curIndex==a||this.isAnimating||(this.newIndex=a,this.$target=this.$pages.eq(this.newIndex),"n"===this.options.scroll&&"v"===b)}},k}();a.fn.snapscroll=function(b){return this.each(function(){var c=a(this),d=a.fn.snapscroll.lookup[c.data("snapscroll")];return d||(a.fn.snapscroll.lookup[++a.fn.snapscroll.lookup.i]=new k(this,b),c.data("snapscroll",a.fn.snapscroll.lookup.i),d=a.fn.snapscroll.lookup[c.data("snapscroll")]),"string"==typeof b?d[b].apply(d,[].slice.call(arguments,1)):void 0})},a.fn.snapscroll.lookup={i:0},a.fn.snapscroll.defaults={directionLockThreshold:5,scroll:"n",scrollThreshold:10,speed:400,loop:!0,useTransition:!0}}(Zepto,window);